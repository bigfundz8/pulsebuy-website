"use strict";(()=>{var e={};e.id=2829,e.ids=[2829],e.modules={1185:e=>{e.exports=require("mongoose")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},6249:(e,t)=>{Object.defineProperty(t,"l",{enumerable:!0,get:function(){return function e(t,n){return n in t?t[n]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,n)):"function"==typeof t&&"default"===n?t:void 0}}})},7314:(e,t,n)=>{n.r(t),n.d(t,{config:()=>p,default:()=>m,routeModule:()=>f});var s={};n.r(s),n.d(s,{default:()=>d});var r=n(1802),i=n(7153),o=n(6249),a=n(5130),l=n(6955);let u=require("bcryptjs");var c=n.n(u);async function d(e,t){if("GET"===e.method)try{await (0,a.Z)();let e=await l.Z.find().select("-password");t.status(200).json({success:!0,users:e})}catch(e){console.error("Fout bij ophalen gebruikers:",e),t.status(500).json({success:!1,message:"Fout bij ophalen gebruikers"})}else if("POST"===e.method)try{let{name:n,email:s,password:r}=e.body;if(!n||!s||!r)return t.status(400).json({success:!1,message:"Alle velden zijn verplicht"});if(await (0,a.Z)(),await l.Z.findOne({email:s}))return t.status(400).json({success:!1,message:"Gebruiker bestaat al"});let i=await c().hash(r,12),o=new l.Z({name:n,email:s,password:i,role:"customer"});await o.save(),t.status(201).json({success:!0,message:"Gebruiker succesvol aangemaakt",user:{id:o._id,name:o.name,email:o.email,role:o.role}})}catch(e){console.error("Fout bij registreren:",e),t.status(500).json({success:!1,message:"Fout bij registreren",error:e.message})}else t.status(405).json({message:"Method not allowed"})}let m=(0,o.l)(s,"default"),p=(0,o.l)(s,"config"),f=new r.PagesAPIRouteModule({definition:{kind:i.x.PAGES_API,page:"/api/users",pathname:"/api/users",bundlePath:"",filename:""},userland:s})},5130:(e,t,n)=>{n.d(t,{Z:()=>l});var s=n(1185),r=n.n(s);let i="mongodb://localhost:27017/dropshipmotion";if(!i)throw Error("Please define the MONGODB_URI environment variable inside .env.local");let o=global.mongoose;async function a(){if(o.conn)return o.conn;o.promise||(o.promise=r().connect(i,{bufferCommands:!1,retryWrites:!0}).then(e=>(console.log("Connected to MongoDB"),e)));try{o.conn=await o.promise}catch(e){throw o.promise=null,e}return o.conn}o||(o=global.mongoose={conn:null,promise:null});let l=a},6955:(e,t,n)=>{n.d(t,{Z:()=>o});var s=n(1185),r=n.n(s);let i=new(r()).Schema({email:{type:String,required:!0,unique:!0,lowercase:!0,trim:!0},password:{type:String,required:function(){return"admin"===this.role},minlength:6},firstName:{type:String,required:!0,trim:!0},lastName:{type:String,required:!0,trim:!0},phone:{type:String,trim:!0},address:{street:String,city:String,postalCode:String,country:{type:String,default:"Netherlands"}},role:{type:String,enum:["customer","admin"],default:"customer"},isActive:{type:Boolean,default:!0},emailVerified:{type:Boolean,default:!1},emailVerificationToken:String,passwordResetToken:String,passwordResetExpires:Date,preferences:{newsletter:{type:Boolean,default:!0},notifications:{type:Boolean,default:!0}},lastLogin:Date,loginAttempts:{type:Number,default:0},lockUntil:Date},{timestamps:!0});i.virtual("fullName").get(function(){return`${this.firstName} ${this.lastName}`}),i.virtual("isLocked").get(function(){return!!(this.lockUntil&&this.lockUntil>Date.now())}),i.methods.incLoginAttempts=function(){if(this.lockUntil&&this.lockUntil<Date.now())return this.updateOne({$unset:{lockUntil:1},$set:{loginAttempts:1}});let e={$inc:{loginAttempts:1}};return this.loginAttempts+1>=5&&!this.isLocked&&(e.$set={lockUntil:Date.now()+72e5}),this.updateOne(e)},i.methods.resetLoginAttempts=function(){return this.updateOne({$unset:{loginAttempts:1,lockUntil:1}})};let o=r().models.User||r().model("User",i)},7153:(e,t)=>{var n;Object.defineProperty(t,"x",{enumerable:!0,get:function(){return n}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(n||(n={}))},1802:(e,t,n)=>{e.exports=n(145)}};var t=require("../../webpack-api-runtime.js");t.C(e);var n=t(t.s=7314);module.exports=n})();